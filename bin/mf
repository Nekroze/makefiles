#!/usr/bin/env bash
set -euo pipefail

# resolve the script name to the actual file on disk
file="${BASH_SOURCE[0]}"
while [ -h "$file" ]; do
    file="$(readlink "$file")"
done

if [ -z "${MF_PROJECT_ROOT:-}" ]; then
    2>&1 echo "MF_PROJECT_ROOT must be defined"
    exit 1
elif [[ "$MF_PROJECT_ROOT" != /* ]]; then
    2>&1 echo "MF_PROJECT_ROOT must be an absolute path"
    exit 1
fi

export MF="$file"
export MF_VERSION="1"
export MF_ROOT="$MF_PROJECT_ROOT/.makefiles"

"$MF_ROOT/lib/core/command/$1.bash" "${@:2}"
