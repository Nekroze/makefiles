#!/usr/bin/env bash
set -euo pipefail
source "$(dirname ${BASH_SOURCE[0]})/../include/common.bash"

if ! git symbolic-ref --short HEAD > /dev/null 2>&1; then
    regex="^v?((0|[1-9][0-9]*)\\.(0|[1-9][0-9]*)\\.(0|[1-9][0-9]*)(\\-[0-9A-Za-z-]+(\\.[0-9A-Za-z-]+)*)?(\\+[0-9A-Za-z-]+(\\.[0-9A-Za-z-]+)*)?)$"
    tag="$(git describe --exact-match HEAD 2>/dev/null)"

    if [[ "$tag" =~ $regex ]]; then
        echo ${BASH_REMATCH[1]}
        exit 0
    fi
fi

echo "0.0.0-$(git rev-parse --short --verify HEAD)"
